<div id="form-wrapper" style="max-width: 600px; margin: auto; font-family: Arial, sans-serif; padding: 20px 16px 40px; box-sizing: border-box;">
  <h2 style="text-align: center; color: #228B22; font-weight: bold; font-size: 28px;">Äáº·t Lá»‹ch Trá»‹ Liá»‡u</h2>

  <label><b>1. Báº¡n biáº¿t Äá»¨C TÃ‚M qua dá»‹ch vá»¥ nÃ o?</b></label><br>
<div style="font-size: 17px; line-height: 1.6;">
  <div style="margin-bottom: 3px;">
    <input type="radio" name="source" value="Youtube/Google"> Youtube/Google
  </div>
  <div style="margin-bottom: 3px;">
    <input type="radio" name="source" value="Facebook"> Facebook
  </div>
  <div style="margin-bottom: 3px;">
    <input type="radio" name="source" value="Tiktok"> Tiktok
  </div>
  <div style="margin-bottom: 3px;">
    <input type="radio" name="source" value="Zalo"> Zalo
  </div>
  <div style="margin-bottom: 3px;">
    <input type="radio" name="source" value="NgÆ°á»i ThÃ¢n"> NgÆ°á»i ThÃ¢n
  </div>
</div>

  <hr style="border: 1px solid #ddd; margin: 20px 0;">

  <h3 style="text-align: center; color: #228B22; font-weight: bold; font-size: 25px; margin-bottom: 4px;">Nháº­p ThÃ´ng Tin</h3>
  <p style="text-align: center; font-style: italic; margin-top: 0;">LÆ°u Ã½</p>

  <label for="name"><b>2. Há» TÃªn:</b></label><br>
  <input type="text" id="name" name="name" placeholder="Nháº­p há» vÃ  tÃªn" style="width: 100%; padding: 8px;"><br><br>

  <label for="phone"><b>3. Sá»‘ Äiá»‡n Thoáº¡i:</b></label><br>
  <input type="tel" id="phone" name="phone" placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i" pattern="[0-9]{10,11}" title="Chá»‰ Ä‘Æ°á»£c nháº­p sá»‘, tá»« 10-11 chá»¯ sá»‘" style="width: 100%; padding: 8px;"><br><br>

  <label for="date"><b>4. Báº¡n Muá»‘n Äáº·t Lá»‹ch VÃ o NgÃ y NÃ o?</b></label><br>
  <input type="date" id="date" name="date" value="" style="width: 100%; padding: 8px;"><br><br>

  <label for="time"><b>5. Thá»i gian nÃ o?</b></label><br>
  <input type="time" id="time" name="time" value="" style="width: 100%; padding: 8px;"><br><br>

  <hr style="border: 1px solid #ddd; margin: 20px 0;">

  <h3 style="text-align: center; color: #228B22; font-weight: bold; font-size: 25px; margin-bottom: 4px;">Dá»‹ch Vá»¥ Liá»‡u TrÃ¬nh</h3>
  <p style="text-align: center; font-style: italic; margin-top: 0;">LÆ°u Ã½: Äƒn sÃ¡ng trÆ°á»›c khi Ä‘áº¿n cÆ¡ sá»Ÿ trá»‹ liá»‡u</p>

  <label><b>7. Báº¡n muá»‘n phá»¥c vá»¥ liá»‡u trÃ¬nh nÃ o?</b></label><br>
  <div style="font-size: 17px; line-height: 1.6;">
    <input type="checkbox" name="service" value="1 - Giáº£m Ä‘au Ä‘áº§u, viÃªm xoang, máº¥t ngá»§"> 1 - Giáº£m Ä‘au Ä‘áº§u, viÃªm xoang, máº¥t ngá»§<br>
    <input type="checkbox" name="service" value="2 - Cá»• vai gÃ¡y"> 2 - Cá»• vai gÃ¡y<br>
    <input type="checkbox" name="service" value="3 - VÃ¹ng Ä‘au"> 3 - VÃ¹ng Ä‘au<br>
    <input type="checkbox" name="service" value="4 - Khai thÃ´ng kinh láº¡c toÃ n thÃ¢n"> 4 - Khai thÃ´ng kinh láº¡c toÃ n thÃ¢n<br>
    <input type="checkbox" name="service" value="5 - Giáº£i cÆ¡ thá»ƒ thao"> 5 - Giáº£i cÆ¡ thá»ƒ thao<br>
    <input type="checkbox" name="service" value="6 - Tá»•ng há»£p"> 6 - Tá»•ng há»£p<br>
    <input type="checkbox" name="service" value="7 - ÄÃ¡nh giÃ³ giÃ¡c hÆ¡i"> 7 - ÄÃ¡nh giÃ³ giÃ¡c hÆ¡i (dá»‹ch vá»¥ thÃªm)<br><br>
  </div>

  <label for="note"><b>8. Ghi chÃº vá» bá»‡nh cá»§a quÃ½ khÃ¡ch (náº¿u cÃ³):</b></label><br>
  <textarea id="note" name="note" rows="4" style="width: 100%; padding: 8px;"></textarea><br><br>

<!-- âœ… Sticky nÃºt gá»­i vÃ  lá»—i -->
  <div style="position: sticky; bottom: 0; background: white; padding-top: 12px; padding-bottom: 20px; text-align: center; z-index: 10;">
    <div id="error-message" style="display: none; color: red; font-weight: bold; margin-bottom: 10px;"></div>
    <button id="submit-button" style="padding: 16px 30px; font-size: 20px; font-weight: bold; background-color: green; color: white; border: none; border-radius: 8px; cursor: pointer;">
      Gá»­i
    </button>
  </div>

 <!-- âœ… Loading spinner -->
 <div id="loading" style="display: none; text-align: center; margin-top: 20px;">
    <div class="spinner"></div>
    <div style="margin-top: 10px; color: #555; font-size: 16px;">Äang gá»­i dá»¯ liá»‡u...</div>
  </div>

</div> <!-- <- ÄÃ¢y lÃ  div bao toÃ n bá»™ form -->

<!-- âœ… MÃ n hÃ¬nh cáº£m Æ¡n -->
<div id="thank-you" style="display: none; max-width: 600px; margin: auto; padding: 100px 20px 50px; text-align: center; font-size: 20px; color: green;">
  <h2 style="color: #228B22; font-size: 30px;">ğŸ‰ Äá»¨C TÃ‚M ğŸ‰</h2>
  <p style="font-size: 25px;">Cáº£m Æ¡n báº¡n Ä‘Ã£ Ä‘áº·t lá»‹ch!</p>
  <p style="font-size: 14px;">XÃ¡c nháº­n lá»‹ch cá»§a báº¡n Ä‘Ã£ Ä‘áº·t thÃ nh cÃ´ng.</p>
  <p style="font-size: 18px;">Äiá»‡n Thoáº¡i : 0941767227</p>
  <p style="font-size: 18px;">Ä/c: 143/7 Phan ÄÄƒng LÆ°u, P.2, Q. PhÃº Nhuáº­n, HCM</p>
  <p style="font-size: 18px;">ğŸ•’ QuÃ½ KhÃ¡ch vui lÃ²ng Ä‘áº¿n Ä‘Ãºng giá». Náº¿u cÃ³ sá»± thay Ä‘á»•i xin quÃ½ khÃ¡ch liÃªn há»‡ Ä‘áº¿n cÆ¡ sá»Ÿ Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£. Xin cÃ¡m Æ¡n QuÃ½ KhÃ¡ch</p>
<!-- NÃºt quay vá» website -->
<a href="https://sites.google.com/view/ductamtrilieu?utm_source=thankspage&utm_medium=redirect&utm_campaign=trang-chu" target="_blank" rel="noopener noreferrer"
   style="display: inline-block; margin-top: 30px; padding: 12px 24px; background-color: #228B22; color: white; font-size: 16px; text-decoration: none; border-radius: 8px;">
  Nháº¥n vÃ o Ä‘Ã¢y Ä‘á»ƒ xÃ¡c nháº­n
</a>
</div>

<!-- âœ… TÄƒng kÃ­ch cá»¡ chá»¯ nháº­p liá»‡u cho mobile -->
<style>
  input, textarea, button {
    font-size: 16px;
  }
  
  .spinner {
    margin: auto;
    border: 6px solid #f3f3f3;
    border-top: 6px solid #228B22;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>

<script>
  // Set ngÃ y tá»‘i thiá»ƒu lÃ  hÃ´m nay (UTC+7)
  const today = new Date();
  const timezoneOffset = 7 * 60; // UTC+7
  today.setMinutes(today.getMinutes() - today.getTimezoneOffset() + timezoneOffset);
  document.getElementById("date").min = today.toISOString().split("T")[0];

    // âœ… Khi DOM Ä‘Ã£ load xong, gÃ¡n sá»± kiá»‡n
 document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("submit-button").addEventListener("click", submitForm);
  });

  // âœ… HÃ m hiá»ƒn thá»‹ lá»—i báº±ng khung (thay vÃ¬ popup alert)
 function showError(message) {
    const errorDiv = document.getElementById("error-message");
    errorDiv.innerText = message;
    errorDiv.style.display = "block";
   
   // áº¨n sau 3 giÃ¢y (3000ms)
    setTimeout(() => {
      errorDiv.style.display = "none";
    }, 2000);
  }

  // âœ… HÃ m xá»­ lÃ½ submit
  function submitForm(event) {
    event.preventDefault(); // âœ… NgÄƒn reload hoáº·c lá»—i submit máº·c Ä‘á»‹nh trong iframe
    
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    const note = document.getElementById("note").value.trim();

    const sourceSelected = document.querySelector('input[name="source"]:checked');
    const serviceSelected = document.querySelectorAll('input[name="service"]:checked');

   // âœ… Thay vÃ¬ alert, dÃ¹ng showError
   if (!sourceSelected) return showError("Vui lÃ²ng chá»n báº¡n biáº¿t Ä‘áº¿n Äá»¨C TÃ‚M qua dá»‹ch vá»¥ nÃ o.");
    if (!name) return showError("Vui lÃ²ng nháº­p há» tÃªn.");
    if (!phone.match(/^[0-9]{10,11}$/)) return showError("Vui lÃ²ng nháº­p sá»‘ Ä‘iá»‡n thoáº¡i há»£p lá»‡ (10-11 sá»‘).");
    if (!date) return showError("Vui lÃ²ng chá»n ngÃ y Ä‘áº·t lá»‹ch.");
    if (!time) return showError("Vui lÃ²ng chá»n thá»i gian.");
    if (serviceSelected.length === 0) return showError("Vui lÃ²ng chá»n Ã­t nháº¥t má»™t dá»‹ch vá»¥ trá»‹ liá»‡u.");

     // âœ… Show loading
    document.getElementById("loading").style.display = "block";
    const submitBtn = document.getElementById("submit-button");
    submitBtn.disabled = true;
    submitBtn.innerText = "Äang gá»­i...";

    // âœ… Gá»­i dá»¯ liá»‡u báº±ng x-www-form-urlencoded (khÃ´ng bá»‹ lá»—i CORS)
const formData = new URLSearchParams();
formData.append("source", sourceSelected.value);    
formData.append("name", name);
formData.append("phone", phone);
formData.append("date", date);
formData.append("time", time);
formData.append("service", Array.from(serviceSelected).map(s => s.value).join(", "));
formData.append("note", note);

fetch("/api/submit", {
  method: "POST",
  headers: {
    "Content-Type": "application/x-www-form-urlencoded"
  },
  body: formData.toString()
})
.then(response => response.text())
.then(result => {
  // áº¨n thÃ´ng bÃ¡o lá»—i náº¿u trÆ°á»›c Ä‘Ã³ cÃ³
  document.getElementById("error-message").style.display = "none";
  
  // áº¨n form Ä‘áº·t lá»‹ch
  document.querySelector("#form-wrapper").style.display = "none";

  // Hiá»‡n mÃ n hÃ¬nh cáº£m Æ¡n
  document.getElementById("thank-you").style.display = "block";
  document.getElementById("loading").style.display = "none";
  // Cuá»™n lÃªn Ä‘áº§u trang
  window.scrollTo(0, 0);
 
  // Gá»­i tÃ­n hiá»‡u cho trang cha Ä‘á»ƒ scroll lÃªn Ä‘áº§u (khi trong iframe)
  if (window.parent !== window) {
    window.parent.postMessage("scroll-to-top", "*");
  } else {
    // Náº¿u khÃ´ng pháº£i iframe thÃ¬ tá»± scroll
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
})
.catch(error => {
  alert("ÄÃ£ xáº£y ra lá»—i khi gá»­i dá»¯ liá»‡u. Vui lÃ²ng thá»­ láº¡i.\n" + error);
      document.getElementById("loading").style.display = "none";
      submitBtn.disabled = false;
      submitBtn.innerText = "Gá»­i";
    });
  }
</script>









